name: Daily Culture Podcast

on:
  schedule:
    - cron: '0 8 * * *'  # æ¯å¤©8:00è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´16:00ï¼‰
  workflow_dispatch:  # æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ main ]
    paths:
      - 'culture_*.py'
      - 'culture_database.py'

jobs:
  generate-podcast:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: è®¾ç½®Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install edge-tts PyYAML
    
    - name: ç”Ÿæˆæ–‡åŒ–æ’­å®¢
      run: |
        echo "ğŸ¨ å¼€å§‹ç”Ÿæˆæ¯æ—¥æ–‡åŒ–æ’­å®¢..."
        python culture_core.py
        
        echo "ç”Ÿæˆçš„éŸ³é¢‘æ–‡ä»¶:"
        ls -la culture_podcast/audio/ 2>/dev/null || echo "æ— éŸ³é¢‘æ–‡ä»¶"
        
        echo "ç”Ÿæˆçš„å…ƒæ•°æ®:"
        ls -la culture_podcast/metadata/ 2>/dev/null || echo "æ— å…ƒæ•°æ®"
    
    - name: ç”Ÿæˆè§†é¢‘ï¼ˆå¯é€‰ï¼‰
      run: |
        if [ -f "simple_video.py" ]; then
          echo "ğŸ¬ ç”Ÿæˆè§†é¢‘å·å†…å®¹..."
          python simple_video.py --auto
          
          echo "ç”Ÿæˆçš„è§†é¢‘æ–‡ä»¶:"
          ls -la weixin_videos/ 2>/dev/null || echo "æ— è§†é¢‘æ–‡ä»¶"
        else
          echo "âš ï¸  è·³è¿‡è§†é¢‘ç”Ÿæˆ"
        fi
    
    - name: ä¸Šä¼ æ’­å®¢æ–‡ä»¶
      uses: actions/upload-artifact@v3
      with:
        name: culture-podcast
        path: |
          culture_podcast/audio/*.mp3
          culture_podcast/metadata/*.json
          weixin_videos/*.mp4
        retention-days: 7
    
    - name: ç”Ÿæˆæ€»ç»“
      run: |
        echo "ğŸ‰ æ¯æ—¥æ–‡åŒ–æ’­å®¢ç”Ÿæˆå®Œæˆï¼"
        echo "ğŸ“… å®Œæˆæ—¶é—´: $(date)"
        echo "ğŸ“¥ ä¸‹è½½åœ°å€: åœ¨Artifactsä¸­ä¸‹è½½ culture-podcast"
